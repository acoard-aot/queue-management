config:
  # Can toggle below
  target: "http://localhost:5000"
  # ws:
  #   headers:
  #     Cookie: "oidc-jwt=cookievalue"
  socketio:
    path: "/api/v1/socket.io"
    transports: ["websocket"]
    extraHeaders:
      Cookie: "oidc-jwt=eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJZUktnVzA0QmJ4QUxpODQ1cy1DdjRURElkMkdZWDc2aHgzM2RIekFCUEZjIn0.eyJleHAiOjE2MDQ2MTkyODcsImlhdCI6MTYwNDYxODk4NywianRpIjoiNmZhNjJiNTYtNDYwZC00YWVkLWI0ZjMtZWY3NDA0ZGEzMDU4IiwiaXNzIjoiaHR0cHM6Ly9kZXYub2lkYy5nb3YuYmMuY2EvYXV0aC9yZWFsbXMvdnRrYXlxNGMiLCJhdWQiOlsiY2Ztcy1kZXYiLCJhY2NvdW50Il0sInN1YiI6IjhhZDY2YzAzLTA0NWQtNDFkZi04NjAxLWFiMmM2OGUyMTc3MyIsInR5cCI6IkJlYXJlciIsImF6cCI6ImNmbXMtZGV2LXN0YWZmIiwic2Vzc2lvbl9zdGF0ZSI6IjFhN2I4MDNhLTQ3Y2QtNDBlYS05ZmYxLWE3MWUzMGRhYzZhNSIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiaHR0cHM6Ly9kZXYtdGhlcS5wYXRoZmluZGVyLmdvdi5iYy5jYS8qIiwibG9jYWxob3N0OjgwODAiLCJodHRwczovL2Rldi10aGVxLmFwcHMuc2lsdmVyLmRldm9wcy5nb3YuYmMuY2EvKiIsImh0dHA6Ly9sb2NhbGhvc3Q6NTAwMCIsIioiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iLCJpbnRlcm5hbF91c2VyIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJuYW1lIjoiQWRtaW4gQWRtaW4iLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJhZG1pbiIsImdpdmVuX25hbWUiOiJBZG1pbiIsImZhbWlseV9uYW1lIjoiQWRtaW4ifQ.oZ9KwwqHXlXAKhZPFM_1aHdd-_cD1I_pL-11ERqVQ2_yNFOMik018yBCijzbVU0bsBctVDwX50otYuOGLLgzTaksDSjA0tCB_YFgsVqvma6V7VTsqBJJj53WgX1wlphRvjzwBZkkTT8HOhNrZljlWZ82NWakXQXqOhl9aDXEI72GU_5F8utXFWrg9l2YLi_rPlk3gOejo71Y016yqth6a3laKxnvzmre_HDUzgjNthb5JSvE9EjplDsztHQ5alB6Tsc1CsILoFgkuzTIhEvjQJADH7wVTJ-2op_M_Y7BN_xlmxCfiishIm-S-50n0nbVE7orXpY8j1c8hEV0Wt09Bw;"
    # target: "https://dev-theq.pathfinder.gov.bc.ca"
  http:
    maxSockets: 3

  phases:
    - duration: 3
      arrivalRate: 1
      name: Warm up
    # - duration: 30
    #   arrivalRate: 10
    #   name: Ramp up load
  variables:
  processor: "./functions.js"

scenarios:
  - name: "CSR - Websockets"
    beforeRequest: 'setAuthHeader'
    engine: "socketio"

    weight: 75
    flow:
      # - function: "testvalue"
      # - get:
      #     url: "/api/v1/citizens/" 
      # - get:
      #   - url: "/queue"
      # TODO - Rest of requests, there's at least 5
      # - get:
      #     url: "/api/v1/socket.io/?EIO=3&transport=websocket"
      - log: " socket connectiong starting"
      - emit:
          channel: "connect"
          data: "ping"
      - think: 1
      - emit:
          channel: "joinRoom"
          data: "joinRoom"
          # response:
          #   channel: "joinRoom"
          #   data: "joinRoomSuccess"
      - log: "joinRoom socket"
      - think: 1




    # - name: "CSR - Socket Connection"
    #   engine: "socketio"
    #   beforeRequest: 'setAuthHeader'
    #   flow:
    #     - get:
    #         url: "/api/v1/citizens/"
        # - emit:
        #     channel: "joinRoom"
        #     data: "hello"
        #     response:
        #       channel: "echoed"
        #       data: "hello"
        # - emit:
        #     channel: "echo"
        #     data: "world"
        #     response:
        #       channel: "echoed"
        #       data: "world"
        # - think: 1
        # - emit:
        #     channel: "echo"
        #     data: "do not care about the response"
        # - emit:
        #     channel: "echo"
        #     data: "still do not care about the response"
        # - think: 1



# TODO - Add SocketIO tests --  
# engine: "socketio"
